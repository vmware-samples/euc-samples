# Set AirWatch App Catalog Webclip on All User Docks #

## Overview
- **Author**: John Richards
- **Email**: jrichards@vmware.com
- **Date Created**: 4/27/2018
- **Supported Platforms**: AirWatch version 8.4+
- **Tested on macOS Versions**: macOS High Sierra

## Problem / Use Case
You can only deploy the (legacy) AirWatch App Catalog Webclip, via MDM, in the user context to the primary managed user. This means, in some organizations, that other local users on the device will not be able to access the App Catalog, unless they know the exact url.

## Solution
The App Catalog webclip is comprised of just a specific url for the device to retrieve the list of available applications. This package dynamically creates this url, and the webclip (.webloc file) and saves it to `/Users/Shared/VMware` with permissions readable by all users. It also places a global LaunchAgent to load on *every user's next login*, to run another script to place the webclip on the user's dock. Once the webclip is added to the dock, a runonce file is created at `~/.appcatalog_runonce` to prevent the script from running again and creating duplicate webclips on the dock.

Please see [Required Changes](#Required-Changes) section for one modification you must make to the code for your deployment. You can also optionally use your own icon image, instead of the default one provided at `payload/Users/Shared/VMware/Catalog.png`

This solution works for both Administrator and Standard users.

Logs are generated at `/Users/Shared/VMware/catalogtodock.log`

## Packaging
This repository is setup to build with `munkipkg`

### To build with [munkipkg](https://github.com/munki/munki-pkg)
First modify the `build-info.json` file for your certificate in login keychain. Then run:


```
munkipkg Legacy\ App\ Catalog\ Webclip\ For\ All\ Docks/
```



If you do not want to use `munkipkg`, you can use `pkgbuild` and `productbuild`

### To build with pkgbuild and productbuild:
```
pkgbuild --install-location / --identifier "com.vmware.airwatch.catalogtodock" --version "1.0" --root ./payload/ --scripts ./scripts/ ./build/catalogtodock-1.0.pkg
```

Optional: To convert the flat pkg to a signed distribution pkg, use the below command but modify for your certificate in login keychain

```
productbuild --sign "Developer ID Installer: VMWARE AIRWATCH (MXNCQ3W382)" --package ./build/catalogtodock-1.0.pkg ./build/signed_catalogtodock-1.0.pkg
```


## Deploy the pkg via AirWatch
To deploy this package via **macOS Software Distribution**, upload the .pkg file in **Apps & Books > Internal Apps**. You will also need to upload a pkginfo/metadata file generated by the VMware AirWatch Admin Assistant. Then continue through the wizard to assign and deploy. Requires AW 9.3+ and Agent 3.0+

To deploy this package via **Product Provisioning**, create a macOS File/Action to drop the pkg in a file location, and then use the `Install` action to install it. Requires AW 8.4+ and Agent 2.2+

If signed, this pkg can be distributed through **Bootstrap Package** feature. [See more info here](https://github.com/vmwaresamples/AirWatch-samples/tree/master/macOS-Samples/BootstrapPackage). Requires AW 9.2+



## Required Changes
1. Change the console url in `scripts/postinstall` to your organization's environment url.

2. Turn off the automatic App Catalog webclip publishing for macOS on the Console. This will prevent two webclips on the primary managed user's dock. The location of this Settings page varies depending on AW Version.
	* AW 9.1+ - **Settings > Apps > Workspace ONE > AirWatch Catalog > General > Publishing**
	* AW 9.0 and earlier - **Settings > Apps > Catalog > General > Publishing**

3. Optionally upload your own 120x120px icon image to replace Catalog.png. If you use a different name from *Catalog.png* you will need to update the code in `payload/Users/Shared/VMware/catalogtodock.py`

## Change Log
- 4/27/2018: First version


## Additional Resources
None
